---
layout:     post
title:      Linux汇编基础知识
subtitle:   汇编很难，但是学会很简单
date:       2017-08-28
author:     BY TALA
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - Blog
---


> 自己收集部分内容，如有错误，请联系youngtala@gmail.com



## Linux汇编基础知识

汇编语言分为intel风格和AT＆T风格，前者被Microsoft Windows/Visual C++采用，Linux下，基本采用的是AT＆T风格汇编，两者语法有很多不同的地方。

### 寄存器访问格式不同
在 AT&T 汇编格式中，寄存器名要加上 '%' 作为前缀；而在 Intel 汇编格式中，寄存器名不需要加前缀。例如：

    AT&T: pushl %eax
    Intel： push eax

### 立即数表示不同

在 AT&T 汇编格式中，用 '$' 前缀表示一个立即操作数；而在 Intel 汇编格式中，立即数的表示不用带任何前缀。例如：

    AT&T: pushl $1
    Intel： push 1

### 操作数顺序不同

在 Intel 汇编格式中，目标操作数在源操作数的左边；而在 AT&T 汇编格式中，目标操作数在源操作数的右边。例如：

    AT&T: addl $1, %eax
    Intel： add eax, 1

也可以这么理解，在Intel汇编格式中，理解为在两个操作数中加一个‘=’，即：

    AT&T: addl $1 -> %eax；用->箭头表示指向操作数
    Intel： add eax = 1；用=等号表示对左侧操作数进行加和







## 函数的序幕和清尾

C语言的函数通常使用类似下面的代码片段作为序幕:

```
push  ebp
mov   ebp, esp
sub   esp, X
```

这些指令将EBP寄存器的值入栈，然后把ESP赋值给EBP，最后在栈中为局部变量分配一段空间。

在函数执行过程中EBP是固定的，可以用来作为访问局部变量和函数参数的基址。虽然也可以使用ESP，但在函数运行过程中，ESP可能会变化，使用起来不太方便。

函数清尾主要包括：释放栈中分配的空间，恢复EBP寄存器中的值，最后把控制流交由调用者：

```
mov  esp, ebp
pop  ebp
ret  0
```

函数的序幕和清尾代码片段通常被反汇编器作为函数定义的检测代码。